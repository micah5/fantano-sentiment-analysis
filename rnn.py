# coding=utf-8
import matplotlib.pyplot as plt
import tensorflow as tf
import numpy as np
from scipy.spatial.distance import cdist

from keras.models import Sequential, load_model
from keras.layers import Dense, GRU, Embedding
from keras.optimizers import Adam, SGD
from keras.preprocessing.text import Tokenizer
from keras.preprocessing.sequence import pad_sequences
import json

from numpy import array
from numpy import argmax
from keras.utils import to_categorical
import random

#np.set_printoptions(threshold='nan')

def tokens_to_string(tokens):
    # Map from tokens back to words.
    words = [inverse_map[token] for token in tokens if token != 0]
    # Concatenate all words.
    text = " ".join(words)
    return text

#step 0: dataset
with open('results.json') as json_data:
    data = json.load(json_data)
x, y = [], []
for obj in data:
    x.append(obj['x']) # text of review
    #y.append(float(random.randint(0,10)/10.0))#(obj['y']-0.0)/(10.0-0.0)) # score 0-10, normalized
    y.append(float((obj['y']-0.0)/(10.0-0.0))) # score 0-10, normalized

#step 1: vocabulary
num_words = 1000
tokenizer = Tokenizer(num_words=num_words)
tokenizer.fit_on_texts(x)
'''for i in range(0, 100):
    print i, [key for key, value in tokenizer.word_index.iteritems() if value == (i + 1)][0]'''
x_tokens = tokenizer.texts_to_sequences(x)
num_tokens = np.array([len(tokens) for tokens in x_tokens])
max_tokens = int(np.mean(num_tokens) + 2 * np.std(num_tokens))
x_pad = pad_sequences(x_tokens, maxlen=max_tokens, padding='pre', truncating='pre')
idx = tokenizer.word_index
inverse_map = dict(zip(idx.values(), idx.keys()))

# one hot encode target
#y_encoded = to_categorical(y)
print y
y_encoded = y

#step 2: embedding
embedding = Embedding(input_dim=num_words,
                    output_dim=8,
                    input_length=max_tokens,
                    name='layer_embedding')

#step 3: rnn
model = Sequential()
model.add(embedding)
model.add(GRU(units=16, return_sequences=True))
model.add(GRU(units=8, return_sequences=True))
model.add(GRU(units=4))
model.add(Dense(1, activation='sigmoid'))
optimizer = Adam(lr=1e-3)
model.compile(loss='binary_crossentropy',
              optimizer=optimizer,
              metrics=['accuracy'])
model.summary()
model.fit(x_pad, y_encoded,
          validation_split=0.05, epochs=200, batch_size=64)

#step 5: save
model.save('model.keras')

text1 = "hi everyone here the Internet's busiest music nerd and it's time for a review of the new self-titled project from Kanye West and Kid Cudi kids see ghosts thus far it has been a very busy summer for producer songwriter singer rapper you know Louie as Kanye West releasing several mini albums within weeks of one another the first of which while not under his own name did feature his influence and production from front to back of course I am talking about push a tease Daytona a 7 track album that just breached 20 minutes in length all killer no filler then following that was Kanye West's new album yay also 7 tracks also just over 20 minutes equally to the point though not as aggressive and finely tuned as Daytona yay was also noticeably less extravagant and wildly experimental than Kanye's past several albums too but to me this album still struck me as an incredibly unique and important moment for yeh in just how vulnerable and harrowing the material on this album is to me this record felt like Kanye going through an ego withdrawal and showing the suicidal and self-destructive lows that fuel his god complex highs which brings me to the third installment of Kanye related releases this summer kids see ghosts I had an inkling that this album wouldn't sound too much unlike the ghost town track off of yeas latest album because it features Kid Cudi kits egos ghost town and there's also a song on this record titled free ghost town part 2 so there's clearly some kind of linkage going on here so I kind of got to wondering will kids see ghosts be aesthetically similar to that ghost town track will we see a similar fusion of hip hop and guitar music maybe even hip hop and rock not too much unlike Kid Cudi's wizard project which I don't know worries me because I didn't like that album too much also I was so skeptical going into this thing because a lot of kid cudi solo material has been painfully mediocre since man on the moon too and even though I've enjoyed yays recent releases he's in such a state of volatility right now who knows if he can keep this quality up also didn't Kid Cudi and Kanye like have a bit of a rocky friendship thing lately that could affect this project too so I did have reasons to be skeptical going into this album but this record is amazing it's just as brief as everything else EJ has touched so far this year at 23 minutes and 7 tracks but it flows fantastically in its short run time feeling like a full complete album to the point where kids see ghosts actually feels longer than it is it also sounds completely unlike anything Kanye has dropped so far this year really dropped ever and sure while as I predicted there are elements of hip hop and rock being fused on this thing there's so much more there are experimental hip hop elements being worked into this thing clearly some Madlib worship here and there and the grunge enos and the brevity of some of these instrumentals and songs there's even a neo psychedelia edge on this album too I catch whiffs of some Flaming Lips here and there some Yoshimi soft bulletin embryonic and even the terror some shots of hard rock and pop and R&B and even grunge get worked into this thing too occasionally on this record there are some flashes of classic Kanye but there are plenty of moments here to where he is as out there as ever especially with some of the eclectic sample choices one of which is a 1930s Christmas song another one being a Kurt Cobain sample typically on this thing Kanye comes off really manic wild out of control Cudi being really forlorn dejected it's sort of like they're both taking the emotional and and mental problems that they are known for in their music putting out there in their music and sort of forming them like Voltron together into this short but epic experimental hip-hop opus and in a huge contrast from Kanye's a record the production on this thing the verses nearly everything is so meticulously assembled like the rawness the lo-fi production the the feeling of lightning in a bottle the feeling that things on the record were just kind of cobbled together that does not carry over on a kid see ghosts at all I definitely get the sense that the songs on this thing were worked on for a very long time the music and the emotions on this thing are on the edge in every way imaginable for me this thing was mind-blowing on impact and instantaneously catchy - we have the opening track on here feel the love featuring Pusha T push drops are really expressive and flashy intro verse over these very somber synth chords right after these distorted vocal leads from Kid Cudi being echoed out into oblivion it's a really powerful refrain powerful mantra to kick the record off with not only that but Cuddy singing this loud this forcefully and also this on pitch right at the start of the record is is a very good sign so far the song sounds pretty cool pretty low-key pretty trippy strange surely it's a great vibe but I just did not see coming right around the corner at the end of this verse Kanye busting in and kind of simultaneously locking in with these gunshot snares that are marching away into the end of the song and over these snares she's going sounding like Mike Patton while the song builds up this sonic and rhythmic momentum the track suddenly melts into these dreary bass tones and guitar leads that miraculously Kid Cudi's vocal lead still fits on top of even though this track is really short we've gone through the number of compositional transitions that you usually hear in a song double its length the song just ends in such a powerful place thanks to the performance the production really everything the color the volume the texture it's all on high fire is a much more low-key moment on the record the shortest song at 2 minutes and 20 seconds it shows Kanye and Cuddy doing their thing over these very gnarly and rough chunky and twangy guitar samples some eerie woodwind leads to some psychedelic vocal samples and sound effects it doesn't hit as high as sonic Peak as some of the other songs on here but I do feel like lyrically these are important moments for Kanye and Cudi as it seems like they're kind of establishing the personality the vibe the brand of of this collaborative project I also think this track works really well as a depressive counterpoint to the intro cut there's also a marching quality to the percussion on this track to the persistent snare drums and tambourines ba pair that with the guitar sample and Cuddy's haunting humming hanging in the back and the song essentially sounds to me like a pirate dirge but in the best way possible in the best way possible there's also something about Kanye's verse on this track that just reminds me of 2000s era Kanye it's kind of like he's been resurrected but has a newer darker edge the song fourth dimension though struck me as the most classic Kanye moment on the entire record this song features the kind of genius level beat production that reminds me of cuts like Jesus walks Kanye drops this hilariously explicit verse of course it's about sex I love the line in this verse when she tells him he's in the wrong hole and he says he's lost that uh definitely got to me but also I love how Kanye sort of portrays sex as like this psychedelic experience talking about it as if it's like another dimension that I can definitely fuck with and the the line that he ends his verse with saying that if he goes to jail he won't finish the sin and then the rest of the verses just silence then Cuddy's verse this dude has not sounded this cold-blooded since the 2000s and I just love the camaraderie that is coming through on this album between these guys already before we've even hit the halfway point it's like Kanye and Kid Cudi are bringing the best out of one another on this record reminding one another of what each other's strengths are because we know Kanye and Cudi are longtime admirers of each other's work have inspired one another's work and it's like together in closed quarters on this record they each want to do whatever it is that makes one artist hold the other in such a high regard because Cudi singing on this thing is more on point than it's been in years like he's so on pitch it's scary sometimes I think the shakiest vocal moment for him on this thing is some of the moaning at the start of the track reborn but it's not even really that bad but back to fourth dimension Cudi's bars on this thing are really slick really trippy and I love the hilarious vocals snippet that sort of ends the song out talking about you know just have the music do this and that the other thing and then you know just two and a half minutes that's enough for a record the song free is one of my favorites on here I mean almost every song on this thing is a favorite of mine it's this crazy hard rock rap fusion that's just Kanye and Cuddy go absolutely insane on this thing the track is a fantastic extension of some of the themes off the track ghost town throwing out this idea of freedom again and again and again and not just simply social or political freedom really a existential freedom freedom from pain freedom from like mortality the song features these blaring samples have chopped up hard rock guitars it sounds like something out of a Led Zeppelin song a lot of the instrumental though is ode to a very generous sample from a UK instrumental hip hop producer who goes by the name of mr. chop but even knowing that what Cuddy Kanye and ty dolla sign to do on top of this beat is incredible their gargantuan godlike proclamations of I feel every single time Kanye and cutting shout that line I feel like I'm being thrown down into a kaleidoscopic wormhole where all these colors are swirling around my brain ty dolla sign brings these amazing vocal harmonies like these super dense super thick how many vocals are multi-tracked on top of each other it sounds so even though ty dolla sign isn't delivering as extrema vocal performance as Kanye or Cuddy he sounds rock and roll as fuck again Kanye sounds absolutely manic on this track Kid Cudi less so but there's a bit of sass to some of what he delivers on the track guess what babe this song is not simply just a fantastic song by itself it's also redemption for me too like it's a fantastic follow-up to ghost town it also sounds like what wizard should have been and the the the godlike vibe of this track the supernatural vibe of this track feels like something yeezus should have achieved reborn is an amazing and for Lauren cooled down after this cut Cudi singing truly makes the track and I love the songs lyrical themes of moving forward and having no stress getting a clean slate beginning anew the need to hit the reset button once again Kanye drops a fantastic verse on this cut that is one of his most personal yet kind of echoing this very sentiment the haunting background vocals and cue piano and dusty beat may not sound like much just listing them out but they do a whole lot with very little the Frane Cuddy ends with on this track - I think adds a very powerful sentiment to the song questioning which way should he go after either fucking up or going through this reborn process where maybe he's bound to make the same mistakes again then there is the incredibly chilling title track which features the most meditative instrumental on the entire record more supernatural vibes coming off of this track a really eerie Cynthia a spectral chord progression yes Yngwie aka mos def also featuring on this thing on the back end in a very wise and in Sage like short verse Kanye's verse is so great on this thing he comes through with so much authority and the finishing Cuddy montage just ends things off with fireworks the strung out guitar that that basically makes up the bulk of the instrumental here which is a Kurt Cobain sample it's kind of like Cuddy is taking those grunge vibes that he was trying to execute on speeding bullet to heaven but giving them the the song the platform they finally deserve also I love the way the track transitions from these dirty grimy lowdown verses to these heavenly vocal harmonies with Cuddy singing out into the ether with a lot of reverb on his voice whoa whoa then all these incredibly eerie auto-tune vocal harmonies shoot back stayin strong no China lotto me save me please damn the vocal melodies they put together on this track is just incredible Kanye's verse is fantastic on this thing too displaying this cycle of violence like really one of his most conscious sets of bars and years this whole idea of asking or begging to be saved by this supernatural power for a record like this to me is a pretty powerful sentiment to end on I also love some of the psychedelics since that go into this track - again enhancing that neo psychedelic edge and just what a fantastic collection of tracks and I don't necessarily see this album as just simply being a standalone thing I very much see this record and yay to be connected somehow making it difficult for me personally to look at this and say oh you know it's just seven tracks it's just twenty minutes of music no I mean in the grander scheme of things I feel like this album is very much tied to --yes recent release but the track listing on this thing is so freakin watertight there's not a song on this that I don't love - some agree or I don't think adds to the tracklisting fantastically every song builds on the next to create this overwhelming mind-altering and strangely beautiful vibe I truly feel like Kanye and Cuddy put one another artistically to the test on this thing with an amazing mix of emotion sound and genres all of which are super vivid just crashing into one another in this violently beautiful display it's like the cosmos imploding and reality melting and the The Matrix glitching and I'm also super impressed with how forward-thinking difficult to pin down and futuristic this album feels - I am legit feelin a strong 9 - a 10 on this thing what do you what do you think of that hey hey what do you what do you is this is this exciting to you is this does this interest you at all well I liked it I liked it on transition have you given this album a listen did you love it did you hate it what would you rate it you're the best you're the best what should I review next to the like if you like please subscribe and please don't cry just leave a comment in the comments if you're feeling full of thoughts over here next to my head is another video that you can check out hit that up or the link to subscribe to the channel Anthony Fantana kids√≠ goes forever"
text2 = "no theny wait a no here the Internet's busiest music nerd and it's time for a review of the new Kanye West album yay this is the eighth studio album from Chicago native rapper songwriter singer visionary meme provocateur Kardashian cohabit er mr. Kanye West now like usual with a kanye album there was a kind of tumultuous lead-up to the release of this album which of course we have to untangle for a little bit before we talk about the material on this record itself earlier this year Kanye West made a return to Twitter and started frantically dropping all of these weird motivational tweets many of which his fans got behind I guess it felt kind of cool to be caught up in Kanye's mind-state during the creative process of this record but then things kind of took a turn for the worst on Twitter when Kanye started endorsing Donald Trump and wearing the maggot hat then doing one erratic interview after another where his words just didn't really make all that much sense it became painfully clear that he didn't really know a lot about what he was talking about so the past couple of weeks for Kanye have yes been exciting but also very revealing embarrassing and very concerning to of course this is not the first time Kanye's contrarian tendencies have gotten him in hot water or had turned his fans against him so in concept what was happening wasn't altogether new however after the Charlamagne and TMZ interviews it did kind of feel like he was heading toward some kind of point of no return where he was either going against the grain just to go against it or making a fool of himself for attention not only that but there were a few weird non-album tracks released prior to this album that seemed to deal directly in this sort of social media storm Kanye had drummed up for himself the one he did with ti a versus the people was particularly cringy where he kind of tries to work through the mental gymnastics that brought him to this point where he was endorsing Trump on Twitter and then reflecting on the backlash for that with TI kind of playing to him it's also been reported since the TMZ interview since Kanye's 400 years of slavery comment he actually redid quite a bit of the music on this album which given that some of these very recent events are laced into the lyrics of a few parts on this record that's uh I don't know more or less believable but just like yay advertised weeks and weeks and weeks ago this latest record of his is a seven track release and it lasts just 24 minutes in a way it feels very much in league with his recent collaboration with push a tee Daytona which was similarly short sweet and direct which is one thing for push a tee to do a record like this it's an entirely different thing for Kanye to do it because yeah is totally stripped of the extravagance we typically get out of a Kanye release at least a newer Kanye release all the extra bells and whistles and guests I mean there are a few here but there's not really a whole lot on this record that sounds as larger-than-life as anything off of tila or yeezus or My Beautiful Dark Twisted Fantasy not only that but this record does kind of feel like it was pulled together in a relatively short amount of time and honestly for Kanye I kind of find this record to be a refreshing direction because it's been such a long time since we've heard Kanye in the raw like this in such an unfiltered state and not just emotionally but also sonically with a bulk of the production on this thing being handled by him and frequent collaborator Mike Dean who yeh has been making tracks with for so long no doubt he's playing a very supportive role in this release and we also have a little additional production on this thing from apex Martin and Jay Pope and Benny Blanco as well as Francis and lights however the instrumentals on this thing don't sound too much different from what yeh delivered on Pusha T's Daytona there's a similar emphasis on very simple mixes patterns and layering as well as kind of experimental and strange synth sounds and samples and sure while on the surface yeh might seem less experimental than Kanye's oddity opus in 2016 the life of Pablo this is probably the most intimate and unguarded Kanye has been on a record since the college dropout and even though it's not as all-encompassing as jay-z's 444 it's on a similarly personal vibe this thing opens up would be very freaky and intense I thought about killing you which is literally about what the title suggests the track kicks off with these really angelic and subtle background vocal harmonies that are kind of chilling and strange very otherworldly and Kanye isn't rapping at the start of this cut as much as he is just kind of delivering some spoken word talking about killing you talking about killing himself talking about how he sort of struggles with these feelings and this decision despite loving himself and loving you not you you but you know the person he has in mind that person he has in mind being Kanye West himself because of the bipolar angle of the record so at least that's how I'm kind of reading the the lyrics of the song given the mental health angle of the album I'd be lying if I said that I'd never had similarly dark thoughts bitching at the back of my head from time to time and I think that's the case for most people I think but on this track I think Kanye delivers an interesting moment where the audience has to give a bit of pause and kind of reconcile these dark thoughts that they may have in their head from time to time I also love how he kind of portrays these incredibly beautiful thoughts and in love for the people around him those feelings kind of being wrapped in these darker feelings sort of like is his emotions for his family his loved one so on and so forth those sort of inhabit the same dark corners of his mind that some of his worst characteristics come out of deeper into the track he talks about encouraging listeners to speak more freely talking about having to potentially rewrite this song or other songs or other lyrics or whatever just being worried how the audience will take it having to compensate for this fear that the listener will take something that he said very negatively the song eventually starts to build with this very steady kind of melodic flow a freaky beats which up with these horrific blood-curdling screams and really glassy since Kanye rapping about working on a different set of rules being easily provoked it just kind of functions really well as an introduction to this album which i think is just kind of an exploration of a snapshot of Kanye's headspace around this exact point in time the song yikes goes even deeper into Kanye's dark mental state where he is essentially as scary himself and the people around him there's a winning song hook from Kanye a very simple beat but an incredibly killer flow and the lyrics on this thing essentially portray a man who is on the edge high off of his own ego and psychedelic drugs to rapping about praying for Russell Simmons because he got me to that lying on here about saying a of watch he has a hospital band talking about Prince and Michael Jackson trying to warn him maybe it's a spiritual something that's kind of making him see this vision or maybe it's him in the midst of a trip I don't know maybe it's as a result of the kind of mental disorders that he references so boldly on the front cover of this thing either way this track is simultaneously one of Kanye is darkest and catchiest yet the song all mine is the first moment on the album that I think this thing really falters and mostly because the opening guest vocals which are kind of sung in this very childish very silly falsetto are a little off-putting at first the B is a little too minimal the song itself I think is a little too short yeh still sounds like a total monster on the track and sexually sort of seems to laser focus on his addiction to sex and women and while he's definitely hinted toward this very hard on tracks previous this is the first time where I feel like he's he's really portrayed this desire of his as a real dark side of himself as a real addiction something that truly makes him feel almost like sick it's a character flaw I also love the noisy abrasive samples that yeh tosses into the last leg of the track it really kind of brings the song to life gives the track and incredibly experimental edge and to me reads like Kanye just internally screaming through his production I think the record bounces back pretty hard on the song wouldn't leave which is essentially about Kanye dealing with the fallout of his political comments on Twitter having to calm his wife down because you we're gonna lose it all and so on and so forth the song basically turns into a beautiful ode to women who stick by their very broken men and I like the partynextdoor hook on this thing a lot like this track the hook on it the harmonized vocals is a very kind of slick old-school like throwback 80s R&B vibe to it very smooth I would not have pinned this as being partynextdoor singing had I not known also the glamorous keys on this thing are really tasteful these subtle percussion goes over really well and this transitions fantastically into the song no mistakes which essentially continues the narrative of the album Kanye's sort of acknowledging this dark side of himself acknowledging how it's affecting this very important and significant relationship of his if the previous song on this thing is love being questioned then this song is love being affirmed and between Kanye's flow his delivery the instrumental on this thing this is some seriously classic Kanye West like he's really throwing it back on this song to the point where the song sounds almost like a mixtape that came out in the 2000s got a bit of a low fie quality to it that I liked a lot the song ghost town featuring Kid Cudi might in fact be a bit of a teaser toward the kids see ghost collaboration that him in the cud stir have coming out around the corner and it's maybe one of my favorite tracks on this thing it just has a very generous soul sample hanging in the background of course Cudi singing his appearance on the song is a little rough especially when it's kind of region high registered I don't quite know what it is it seemed like he was really holding out of the melody very well in the first leg of that two line bar that he has to sing but then he just sort of drops it I think it really could have been helped with another take but believe it or not this song actually features some of Kanye's best singing in a long time I mean his singing has always been rough and granted it's not perfect here but like he's actually singing pretty well I just love the nostalgic beat the blaring distorted guitar also that weird John Legend intro on this thing seems like he's almost overcome with the emotion of the song his performance the instrumental I'm not really sure but it kind of adds to this feeling that this is like a live recording or some and yet again we get a track that sort of adds to this narrative that Kanye is just simultaneously somebody who is madly in love with his family but also just very disturbed emotionally which I think sort of comes to a head on the zero seven zero shake this is like a new sign II to good music oh I'm not that familiar with yet outside of the contribution that she had made to push a tease recent release but her singing on this track is absolutely chilling at the very end mostly because of her lyrics talking about how she needs to touch a hot stove to see if she still bleeds and there's no feeling and as a result of that she feels free which sort of goes to show how self-destructive somebody can be in their behavior when they feel invincible I see the closing track on here Violent Crimes is almost like the bound to of the album but instead of it being in ode to his love for his wife the relationship he has with her instead it focuses more on his and while Kanye is far and away from the first rapper to have a daughter and then that forces them to rethink their feelings on the fair sex and then they sort of put those emotions into song he certainly puts his own spin on it you could say elements of this track are kind of overprotective even patriarchal but I think Kanye is being more self-aware in this track than a lot of people might give him credit sort of reacting to what he says on this song right away without really diving deeper into his lyrics or his intentions I see the song is just kind of being a very smartly portrayed struggle internal struggle that Kanye is going to have with these feelings of having a daughter also the gorgeous lavish vocal harmonies on this thing sound great the chord progression is chilling and has a bit of a gospel vibe to it and all in all I just think it's a great ending to this very short release I mean even though yae seems like a pretty unorthodox release for yay I for the most part loved it I think it paints a really smart and vivid picture of his current state of self of his family ties and also his mental health but also I think this is going to be an album where two different camps of yay fans kind of split people who are fans of yay the person yay the artist are really going to enjoy what he delivers on this record but people who are more into his music for the image that he puts up in it for the illusions of grandeur that he delivers you are most likely going to be underwhelmed and sorely disappointed because on this album Kanye doesn't really try to be anything else other than the very broken troubled and conflicted person that he is simply titling this album yeah is incredibly fitting because listening to this feels like you're getting so close to the artist that it almost becomes awkward again depending on how you interpret this and whether or not you like the direction this is going in but if I haven't made this clear enough already I do I I do enjoy this direction of course there are a few moments where I think the rough production and very lightning in a bottle songwriting does kind of kneecap the full potential of a few tracks here and there are other spots on the album where I wish songs were longer or I just wish this overall were longer it almost seems like an injustice for an album tackling the very lofty and dense topics that this album is to just be twenty four minutes in length though I will say I do think it has a hell of a job of that and and actually sequences the songs very well so there's kind of a logical progression and flow to a lot of what Kanye is saying I also want to praise Kanye's lyricism on this thing sure he has his usual very tongue-in-cheek and playful and silly double entendre zand and word plays a few of my favorites being that nobody would be here without come line and also a that sentimental sent to mental bar was amazing but yeah biggest complaint about this thing is really that I just wanted more out of it I would love to hear more I would love to hear more but that being said highly impressed with the seven tracks that are on here to begin with so I'm feeling a decent - strong 8 on this thing transition did you give this album a listen did you love it did you hate it what would you rate it you're the best you're the best what should I review next hit the like if you like please subscribe and please don't cry hit the bell as well over here next to my head is another video that you can check out hit that up or the link to subscribe to the channel Anthony Fantana Kanye West forever"
texts = [text1, text2]
tokens = tokenizer.texts_to_sequences(texts)
tokens_pad = pad_sequences(tokens, maxlen=max_tokens,
                           padding='pre', truncating='pre')
print model.predict(tokens_pad)
